<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vortex OS</title>

<style>
body { font-family: Arial; margin:0; background:#0f172a; color:white; }
header { background:#1e293b; padding:15px; font-size:20px; }
nav button { margin:5px; padding:8px 12px; border:none; cursor:pointer; }
.container { padding:20px; }
input, select { padding:6px; margin:5px 0; width:100%; }
button.primary { background:#3b82f6; color:white; }
.card { background:#1e293b; padding:15px; margin:10px 0; }
.hidden { display:none; }
</style>
</head>

<body>

<header>Vortex Agency OS</header>

<nav id="nav"></nav>

<div class="container" id="app"></div>

<script>

const TABS = ["Дашборд","Финансы","Настройки"];

let State = {
  apiUrl: "",
  role: "Team",
  token: "",
  data: {}
};

function saveSettings(){
  localStorage.setItem("vortex_settings", JSON.stringify(State));
}

function loadSettings(){
  const s = localStorage.getItem("vortex_settings");
  if(s) State = JSON.parse(s);
}

function renderNav(){
  const nav = document.getElementById("nav");
  nav.innerHTML = "";

  TABS.forEach(tab=>{
    if(State.role==="Team" && tab==="Финансы") return;
    const btn = document.createElement("button");
    btn.innerText = tab;
    btn.onclick = ()=>render(tab);
    nav.appendChild(btn);
  });
}

function render(tab="Дашборд"){
  renderNav();
  const app = document.getElementById("app");

  if(tab==="Настройки"){
    app.innerHTML = `
      <div class="card">
        <h3>Настройки</h3>
        API URL:<br>
        <input id="apiUrl" value="${State.apiUrl || ""}">
        Роль:<br>
        <select id="role">
          <option ${State.role==="Founder"?"selected":""}>Founder</option>
          <option ${State.role==="PM"?"selected":""}>PM</option>
          <option ${State.role==="Team"?"selected":""}>Team</option>
        </select>
        Токен:<br>
        <input id="token" value="${State.token || ""}">
        <button class="primary" onclick="saveConfig()">Сохранить</button>
        <button onclick="loadData()">Загрузить данные</button>
      </div>
    `;
  }

  if(tab==="Финансы"){
    app.innerHTML = `
      <div class="card">
        <h3>Добавить транзакцию</h3>
        Сумма:<br>
        <input id="amount">
        <button class="primary" onclick="addTransaction()">Добавить</button>
      </div>
    `;
  }

  if(tab==="Дашборд"){
    app.innerHTML = `
      <div class="card">
        <h3>Добро пожаловать</h3>
        Роль: ${State.role}
      </div>
    `;
  }
}

function saveConfig(){
  State.apiUrl = document.getElementById("apiUrl").value;
  State.role = document.getElementById("role").value;
  State.token = document.getElementById("token").value;
  saveSettings();
  alert("Сохранено");
  render();
}

async function loadData(){
  if(!State.apiUrl){ alert("Нет API URL"); return; }
  const res = await fetch(State.apiUrl);
  const json = await res.json();
  State.data = json.data;
  alert("Данные загружены");
}

async function addTransaction(){
  if(!State.apiUrl){ alert("Нет API URL"); return; }

  const amount = document.getElementById("amount").value;

  const res = await fetch(State.apiUrl,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      sheet:"Transactions",
      action:"append",
      row:{ transaction_id:"T"+Date.now(), amount:amount },
      token:State.token,
      actor:"UI",
      actorRole:State.role
    })
  });

  const json = await res.json();

  if(!json.ok){
    alert("Ошибка: "+json.error);
  } else {
    alert("Добавлено");
  }
}

loadSettings();
render();

</script>

</body>
</html>
